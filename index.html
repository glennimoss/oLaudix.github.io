<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="bootstrap.min.css">
<style type="text/css"><style type="text/css">
		
		table input[type=text][readonly] {
			background: transparent;
			border: none;
		}
		table .hilite {
			background-color: #dff0d8 !important;
		}
		#nonidle input {
			width: 100px;
		}
		.wrapper {
			width: 1504px;
			margin: 0px auto;
		}
		body {
			margin: 15px;
		}
		.btn + .btn {
			margin-left: 10px;
		}
		.table > tbody > tr > td{
			padding: 0px;
			vertical-align: middle;
		}
		.panel-heading > * {
			vertical-align: middle;
		}
		.panel-heading button {
			border: none;
			background: none;
			padding: 0px 1px 0px 1px;
		}
		
		input[type=text] {
    width: 100px;
    margin: 0px;
		border:none;
}
</style>

<script type="text/javascript" src="jquery-latest.min.js"></script>
<script type="text/javascript" src="bootstrap.min.js"></script>
<script src="common.js"></script>
<script src="testing.js"></script>
<title>HTML5, CSS3 and JavaScript demo</title>
  <!--<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>-->
</head>
<body>
	<div class="wrapper">
		<div style="width: 500px; display: inline-block;">
			<div class="panel panel-primary">
				<div class="panel-heading">Save panel</div>
				<div class="panel-body">
					<textarea id="savedata" style="width: 100%; height: 50px"></textarea>
					<div style="margin-top: 10px;">
						<button type="button" onclick="Save()" class="btn btn-default">Save</button>
						<button type="button" onclick="Load()" class="btn btn-primary" style="float: right;">Load</button>
					</div>
				</div>
			</div>
		<!--<label><input type="checkbox" id="addsouls" checked="checked">Include souls gained after ascension</label>-->
			<div class="panel panel-success">
				<div class="panel-heading">Results: <input type="text" id="numberofpredictions" value="30"></div>
				<div id="output" class="panel-body"></div>
			</div>
		</div>
		<div role="tabpanel" style="width: 1000px; display: inline-block; vertical-align: top;">
			<ul class="nav nav-tabs" role="tablist">
				<li role="presentation" class="active"><a href="#heroes" aria-controls="heroes" role="tab" data-toggle="tab">Heroes</a></li>
				<li role="presentation"><a href="#player" aria-controls="player" role="tab" data-toggle="tab">Player</a></li>
				<li role="presentation"><a href="#artifacts" aria-controls="heroes" role="tab" data-toggle="tab">Artifacts</a></li>
			</ul>
			<div class="tab-content">
				<div role="tabpanel" class="tab-pane active" id="heroes">
					<table id="ancienttbl" class="table table-striped">
						<tbody><tr><th width="25%">Name</th><th width="20%">Skills</th><th width="15%">Upgrade Cost</th><th width="15%">DpS</th width="20%"><th>Next Level DpS Diff</th><th width="5%">Level</th></tr>
						</tbody>
					</table>
				</div>
				<div role="tabpanel" class="tab-pane" id="player">
					<table id="playertbl" class="table table-striped">
						<tbody><tr><th width="25%">Name</th><th width="20%">Skills</th><th width="15%">Upgrade Cost</th><th width="15%">DpS</th width="20%"><th>Next Level DpS Diff</th><th width="5%">Level</th></tr>
						</tbody>
					</table>
				</div>
				<div role="tabpanel" class="tab-pane" id="artifacts">
					<div class="panel-heading">
						<div><input type="text" id="artifactbonus" value="0"></input>%
						</div>
						<table id="heroestbl" class="table table-striped">
							<tbody><tr><th>Artifact</th><th>Effect</th><th>Efficiency</th></tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<button type="button" onclick="Calculate()" class="btn btn-default">Update</button>
		</div>
	</div>
  
  

<script language="javascript">/* Write JavaScript here */
//$(window).load(function start(){

for (var i = 0; i < heroList.length; i++) {
  var key = heroList[i];
  var tr = HeroInfo[key].targetBox = $("<tr></tr>");
  //tr.append($("<td></td>"));
  tr.append($("<td></td>").append(HeroInfo[key].name).attr("id", key+"name"));
  HeroInfo[key].used1 = $("<input></input>").attr("type", "checkbox").attr("id", key+"skill1").attr("title", "ha");
  HeroInfo[key].used2 = $("<input></input>").attr("type", "checkbox").attr("id", key+"skill2").attr("title", "ha");
  HeroInfo[key].used3 = $("<input></input>").attr("type", "checkbox").attr("id", key+"skill3").attr("title", "ha");
  HeroInfo[key].used4 = $("<input></input>").attr("type", "checkbox").attr("id", key+"skill4").attr("title", "ha");
  HeroInfo[key].used5 = $("<input></input>").attr("type", "checkbox").attr("id", key+"skill5").attr("title", "ha");
  HeroInfo[key].used6 = $("<input></input>").attr("type", "checkbox").attr("id", key+"skill6").attr("title", "ha");
  HeroInfo[key].used7 = $("<input></input>").attr("type", "checkbox").attr("id", key+"skill7").attr("title", "ha");
  tr.append($("<td></td>").append(HeroInfo[key].used1).append(HeroInfo[key].used2).append(HeroInfo[key].used3).append(HeroInfo[key].used4).append(HeroInfo[key].used5).append(HeroInfo[key].used6).append(HeroInfo[key].used7));
  if (HeroInfo[key].nextUpgradeCost > 1000000)
  {
	tr.append($("<td></td>").append(HeroInfo[key].nextUpgradeCost.toExponential(2)).attr("id", key+"nextUpgradeCost"));
  }
  else
  {
	tr.append($("<td></td>").append(HeroInfo[key].nextUpgradeCost).attr("id", key+"nextUpgradeCost"));
  }
  tr.append($("<td></td>").append(HeroInfo[key].currentDPS).attr("id", key+"currentDPS"));
  tr.append($("<td></td>").append(HeroInfo[key].nextLevelDPSDiff).attr("id", key+"nextLevelDPSDiff"));
  tr.append($("<td></td>").append($("<input></input>").attr("type", "text").val(0).attr("id", key+"heroLevel")));
  tr.append("\n\n");
  $("#ancienttbl").append(tr);
}

function printHeroInfo(hero)
{
	if (hero.currentDPS > 1000000) { $("#Hero"+(hero.heroID)+"currentDPS").html(hero.currentDPS.toExponential(3)); } else { $("#Hero"+hero.heroID+"currentDPS").html(Math.floor(hero.currentDPS)); }
	if (hero.nextLevelDPSDiff > 1000000) { $("#Hero"+(hero.heroID)+"nextLevelDPSDiff").html("+ "+hero.nextLevelDPSDiff.toExponential(3)); } else { $("#Hero"+hero.heroID+"nextLevelDPSDiff").html("+ "+Math.floor(hero.nextLevelDPSDiff)); }
	if (hero.nextUpgradeCost > 1000000) { $("#Hero"+(hero.heroID)+"nextUpgradeCost").html(hero.nextUpgradeCost.toExponential(3)); } else { $("#Hero"+hero.heroID+"nextUpgradeCost").html(Math.floor(hero.nextUpgradeCost)); }
	for (var x = 0; x < 7; x++)
	{
		$("#Hero"+(hero.heroID)+"skill"+(x+1)).prop("title", hero.skills[x].name + "\n" + hero.skills[x].bonusType + "\n"  + hero.skills[x].magnitude);
	}
	$("#Hero"+(hero.heroID)+"currentDPS").prop("title", "Additional dmg: " + (StatBonusAllDamage + hero.currentPassiveThisHeroDamage)*100 + "%");
	$("#playertbl").html(
						"All Damage Bonus: " + StatBonusAllDamage + "<br>" +
						"All Gold Bonus: " + StatBonusGoldAll + "<br>" +
						"Crit Damage Bonus: " + CritDamagePassive + "<br>" +
						"Tap Dmg from DPS Bonus: " + TapDamageFromDPS + "<br>" +
						"Crit Chance Bonus: " + CritChance + "<br>" +
						"Tap Damage Bonus: " + TapDamagePassive
						);
}

function GetDPSByLevel(hero, level)
{
    var num3 = 0.0;
    if (IsEvolved(level))
    {
      num3 = Math.pow(levelIneffiency, (level - heroEvolveLevel)) * Math.pow((1.0 - (heroInefficiency * heroInefficiencySlowDown)), (hero.heroID + 30));
    }
    else
    {
      num3 = Math.pow(levelIneffiency, (level - 1)) * Math.pow((1.0 - (heroInefficiency * Math.min(hero.heroID, heroInefficiencySlowDown))), hero.heroID);
    }
    var num4 = 0.0;
    if (IsEvolved(level))
    {
      num4 = (((GetUpgradeCostByLevel(level - 1, hero.cost) * (Math.pow(heroUpgradeBase, (level - (heroEvolveLevel - 1))) - 1.0)) / ((heroUpgradeBase - 1.0))) * num3) * dMGScaleDown;
    }
    else
    {
      num4 = (((GetUpgradeCostByLevel(level - 1, hero.cost) * (Math.pow(heroUpgradeBase, level) - 1.0)) / ((heroUpgradeBase - 1.0))) * num3) * dMGScaleDown;
    }	
	var artifactBonus = parseFloat($("#artifactbonus").val())/100;
    return (num4 * (1.0 + hero.currentPassiveThisHeroDamage + StatBonusAllDamage)) * (1.0 + artifactBonus);
}

function IsEvolved(iLevel)
{
	return (iLevel >= heroEvolveLevel);
}

function GetUpgradeCostByLevel(iLevel, purchaseCost)
{
    var num = 0.0;
    num = GetHeroBaseCost(iLevel, purchaseCost, iLevel) * Math.pow(heroUpgradeBase, iLevel);
    var a = num;// * (1.0 + PlayerModel.instance.GetStatBonus(BonusType.AllUpgradeCost));
    return Math.ceil(a);
}


function numberFormat(number)
{
  //var tabUnits = [" million", " billion", " trillion", " quadrillion", " quintillion", " sextillion", " septillion", " octillion", " nonillion", " decillion", " undecillion", " duodecillion", " tredecillion", " quattuordecillion", " quindecillion", " sexdecillion", " septendecillion", " octodecillion", " novemdecillion", " vigintillion", " unvigintillion", " duovigintillion", " tresvigintillion", " quattuorvigintillion", " quinquavigintillion", " sesvigintillion", " septemvigintillion", " octovigintillion", " novemvigintillion", " trigintillion", " untrigintillion", " duotrigintillion", " duotrigintillion", " trestrigintillion", " quattuortrigintillion", " quinquatrigintillion", " sestrigintillion", " septentrigintillion", " octotrigintillion", " noventrigintillion", " quadragintillion"];
  var tabUnits = ["K","M","B","T","aa","bb","cc","dd","ee","ff","gg","hh","ii","jj","kk","ll","mm","nn","oo","pp","qq","rr","ss","tt","uu","vv","ww","xx","yy","zz"];
  var highnumber = false; 
  var bignumber = 1000; 
  var tabposition = -1;
  var p_atomepersecond = true;
    var unit;
    if (number >= bignumber) {
        highnumber = true;
        while (number >= bignumber) { bignumber *= 1000; tabposition++; }
        //while (number >= bignumber && tabposition < 4 ) { bignumber *= 1000; tabposition++; }
        number /= (bignumber / 1000);
        unit = tabUnits[tabposition];
    } else unit = "";
    //if (unit == undefined) return "I can't handle that much";
    var toround = (highnumber == true) ? (p_atomepersecond == true) ? 1000 : 100 : 10;
    var res = Math.round(number * toround) / toround;
    return [res.toLocaleString().replace(",", ".") + '' + unit];
}


function GetEfficiency()
{
	var output = [];
    var levels = [];
	var text = "";
	var best = 0;
	var test = 0;
	for (var x = 0; x < 10000; x++)
	{
		//best = 0;
		for (i = 0; i < 30; i++) 
		{	
			if (HeroInfo[heroList[i]].isActive) {   
			var eff = HeroInfo[heroList[i]].efficiency;
			var beff = HeroInfo[heroList[best]].efficiency;
			if (eff/beff < 1)
			{
				//oldbest = best;
				best = i;
			}}
		}
		//alert ("test");
		HeroInfo[heroList[best]].heroLevel += 1;
		GetStatBonusAllDamage();
		GetStatBonusAllDamage();
	GetStatBonusAllGold();
	GetStatBonusCritDamagePassive();
	GetStatBonusTapDamageFromDPS();
	GetStatBonusCritChance();
	GetStatBonusTapDamagePassive();
	//alert(TapDamagePassive);
	//---------------
	UpdateAllHeroesStats();
		//testing();
		if (x == 0) 
		{			
			output.push({
                    name: HeroInfo[heroList[best]].name,
                    level: HeroInfo[heroList[best]].heroLevel
                });
			
			continue;
		}
		if (output[output.length-1].name == HeroInfo[heroList[best]].name)
		{
			output[output.length-1].level = HeroInfo[heroList[best]].heroLevel;
		}
		else
		{
			output.push({
                    name: HeroInfo[heroList[best]].name,
                    level: HeroInfo[heroList[best]].heroLevel
                });
		}
		if (output.length > parseInt($("#numberofpredictions").val()))
		{	
			text += "<table id=\"resulttbl\" class=\"table table-striped\"><tbody>";
			text += "<tr><th>Name</th><th>Level</th></tr>"
			for (var i = 0; i < output.length; i++) 
			{
				output[i].level
				text += "<tr><td>" + output[i].name + "</td><td>" + output[i].level + "</td></tr>"; 
			}
			text += "</tbody></table>";
			$("#output").html(text);
			//alert(test);
			break;
		}
	}
}

var currentAllHeroDPS = 0.0;

function GetLevels()
{	
	for (var i = 0; i < 30; i++)
	{
		HeroInfo[heroList[i]].heroLevel = parseInt($("#Hero"+(i+1)+"heroLevel").val());
	}
}

function UpdateAllHeroesStats()
{
	currentAllHeroDPS = 0.0;
	for (var i = 0; i < 30; i++)
	{
		hero = HeroInfo[heroList[i]];
		hero.currentPassiveThisHeroDamage = currentPassiveThisHeroDamage(hero);
		hero.currentDPS = GetDPSByLevel(hero, hero.heroLevel);
		hero.nextLevelDPSDiff = GetDPSByLevel(hero, hero.heroLevel + 1) - hero.currentDPS;
		hero.nextUpgradeCost = GetUpgradeCostByLevel(hero.heroLevel, hero.cost);
		hero.efficiency = hero.nextUpgradeCost/hero.nextLevelDPSDiff;
		if (hero.heroID >= 2) 
		{	
			hero.isActive = false;
			if (HeroInfo[heroList[hero.heroID-2]].heroLevel > 0){ hero.isActive = true; }
		} 
		else if (hero.heroID <= 1)
		{ 	
			hero.isActive = true; 
		}	
		currentAllHeroDPS += HeroInfo[heroList[i]].currentDPS;
	}
	for (var i = 0; i < 30; i++)
	{	
		hero = HeroInfo[heroList[i]];
		//alert(currentAllHeroDPS);
		hero.earnedGoldIncrease = GetOfflineGoldByTime(10, currentAllHeroDPS + hero.nextLevelDPSDiff) - GetOfflineGoldByTime(10, currentAllHeroDPS);
		//hero.efficiency = (hero.nextUpgradeCost/hero.earnedGoldIncrease);
		//alert(hero.earnedGoldIncrease + " " + hero.heroID);		
	}
}

function UpdateAllSkillsStats()
{

}

function printAll()
{
	for (var i = 0; i < 30; i++)
	{
		printHeroInfo(HeroInfo[heroList[i]]);
	}
}

function GetSkills()
{	
	for (var x = 1; x < 31; x++)
	{
		for (var y = 1; y < 8; y++)
		{
			HeroInfo[heroList[x-1]].skills[y-1].isActive = $("#Hero"+x+"skill"+y).is(":checked");
		}
	}
}

function BuildSkillBase()
{
	var index = 0;
	for (var x = 1; x < 31; x++)
	{
		for (var y = 1; y < 8; y++)
		{
			if (typeof HeroInfo[skillsInfo[index].owner].skills == "undefined") { HeroInfo[skillsInfo[index].owner].skills = []; }
			HeroInfo[skillsInfo[index].owner].skills.push(skillsInfo[index]);
			HeroInfo[heroList[x-1]].isActive = false;
			index++;
		}
	}
}

function GetOfflineGoldByTime(iSeconds, DPS)
{
    var stageBaseHP = 100.0;
    var stageBaseGold = 10.0;
    var num5 = 0.0;
	if (DPS == 0) { DPS+=1; }
    if (DPS > 0.0)
    {
		num5 = (iSeconds / ((stageBaseHP / DPS))) * stageBaseGold;
    }
    var num6 = 0.0;
	var goldAmount = (num5 * (1.0 + num6));
    return goldAmount;
}

function Save()
{	
	GetSkills();
	GetLevels();
	var text = [];
	for (var x = 0; x < 30; x++)
	{	
		var temp = [];
		for (var y = 0; y < 7; y++)
		{
			temp.push(HeroInfo[heroList[x]].skills[y].isActive);
		}
		text.push({level: HeroInfo[heroList[x]].heroLevel, skills: temp})
	}
	var save = JSON.stringify(text);
	$("#savedata").val(save);
	text = [];
	temp = [];
}

function Load()
{	
	var txt = $("#savedata").val();
	var txt2 = jQuery.parseJSON(txt);
	for (var x = 0; x < 30; x++)
	{	
		for (var y = 0; y < 7; y++)
		{
			HeroInfo[heroList[x]].skills[y].isActive = txt2[x].skills[y];
			HeroInfo[heroList[x]].heroLevel = txt2[x].level;
			$("#Hero"+(x+1)+"skill"+(y+1)).prop("checked", HeroInfo[heroList[x]].skills[y].isActive);
			$("#Hero"+(x+1)+"heroLevel").val(HeroInfo[heroList[x]].heroLevel);
		}
	}
	//---------------
	GetSkills();
	GetLevels();
	//---------------
	GetStatBonusAllDamage();
	GetStatBonusAllGold();
	GetStatBonusCritDamagePassive();
	GetStatBonusTapDamageFromDPS();
	GetStatBonusCritChance();
	GetStatBonusTapDamagePassive();
	//alert(TapDamagePassive);
	//---------------
	UpdateAllHeroesStats();
	printAll();
}

BuildSkillBase();
GetSkills();
GetLevels();
GetStatBonusAllDamage();
GetStatBonusAllGold();
GetStatBonusCritDamagePassive();
GetStatBonusTapDamageFromDPS();
GetStatBonusCritChance();
GetStatBonusTapDamagePassive();
UpdateAllHeroesStats();
printAll();
function Calculate() {
	//$("#output").html("");
	//---------------
	GetSkills();
	GetLevels();
	//---------------
	GetStatBonusAllDamage();
	GetStatBonusAllGold();
	GetStatBonusCritDamagePassive();
	GetStatBonusTapDamageFromDPS();
	GetStatBonusCritChance();
	GetStatBonusTapDamagePassive();
	//alert(TapDamagePassive);
	//---------------
	UpdateAllHeroesStats();
	printAll();
	//alert(1.281e34/(GetOfflineGoldByTime(1000, 6.507e20 + 3.899e28) - GetOfflineGoldByTime(1000, 6.507e20)));
	GetEfficiency();
	//$("#ancienttbl").html("test");
}
//});
</script></body></html>